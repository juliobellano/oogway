<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gemini Live API - Vanilla JS Example</title>
    <style>
      :root {
        /* Google Brand Colors */
        --google-blue: #4285f4;
        --google-red: #db4437;
        --google-yellow: #f4b400;
        --google-green: #0f9d58;
      }

      body {
        font-family: Arial, sans-serif;
        transition: all 0.5s ease-in-out;
      }

      .container {
        display: flex;
        gap: 20px;
      }
      .left-column {
        flex: 1;
      }
      .right-column {
        flex: 1;
      }

      #setupJsonDisplay {
        background-color: #f4f4f4;
        padding: 10px;
        overflow-x: auto;
        white-space: pre-wrap;
      }

      .user-transcript:before {
        content: "USER SPEECH: ";
        background-color: var(--google-yellow);
        color: black;
      }

      .user::before {
        content: "USER: ";
        background-color: var(--google-green);
        color: white;
      }

      .assistant:before {
        content: "GEMINI SPEECH: ";
        background-color: var(--google-blue);
        color: white;
      }

      .system:before {
        content: "SYSTEM: ";
        background-color: var(--google-red);
        color: white;
      }

      /* MasterShifu Tutorial Analyzer */
      .master-shifu {
        max-width: 800px;
        margin: 0 auto 30px;
        padding: 20px;
        border: 2px solid var(--google-blue);
        border-radius: 8px;
        background: #f8f9fa;
      }
      .master-shifu h2 {
        margin-top: 0;
        color: var(--google-blue);
      }
      .master-shifu-input {
        display: flex;
        gap: 8px;
        margin-bottom: 16px;
      }
      .master-shifu-input input {
        flex: 1;
        padding: 8px 12px;
        font-size: 14px;
        border: 1px solid #ccc;
        border-radius: 4px;
      }
      .master-shifu-input button {
        padding: 8px 20px;
        font-size: 14px;
        background: var(--google-blue);
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      .master-shifu-input button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }
      .tutorial-step {
        background: white;
        border: 1px solid #ddd;
        border-radius: 6px;
        padding: 12px 16px;
        margin-bottom: 10px;
      }
      .step-header {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 6px;
      }
      .step-number {
        background: var(--google-blue);
        color: white;
        padding: 2px 10px;
        border-radius: 12px;
        font-size: 13px;
        font-weight: bold;
        white-space: nowrap;
      }
      .step-name {
        font-weight: bold;
        font-size: 15px;
      }
      .step-timestamp {
        margin-left: auto;
        font-size: 13px;
        color: #666;
        white-space: nowrap;
      }
      .step-description {
        margin: 4px 0;
        font-size: 14px;
        line-height: 1.5;
      }
      .step-failure {
        margin: 4px 0 0;
        font-size: 13px;
        color: var(--google-red);
      }
      .analyze-loading {
        color: var(--google-blue);
        font-style: italic;
      }
      .analyze-error {
        color: var(--google-red);
      }
      #startGuidedBtn {
        display: none;
        margin-top: 16px;
        padding: 12px 28px;
        font-size: 16px;
        font-weight: bold;
        background: var(--google-green);
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
      }
      #startGuidedBtn:hover:not(:disabled) {
        background: #0b8a4a;
      }
      #startGuidedBtn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }
    </style>
  </head>
  <body>
    <a href="/" style="display:inline-block;margin:12px 20px;font-size:14px;color:#4285f4;text-decoration:none;">&larr; Back to Oogway</a>
    <h1>Gemini Live API - Vanilla JS Example</h1>
    <p>
      Vanilla JavaScript implementation with audio, video, and text streaming
    </p>

    <!-- MasterShifu Tutorial Analyzer -->
    <section class="master-shifu">
      <h2>MasterShifu â€” Tutorial Analyzer</h2>
      <p>Paste a YouTube tutorial URL to extract step-by-step instructions.</p>
      <div class="master-shifu-input">
        <input
          type="text"
          id="tutorialUrl"
          placeholder="https://www.youtube.com/watch?v=..."
          autocomplete="off" />
        <button id="analyzeBtn">Analyze Tutorial</button>
      </div>
      <div id="analyzeResults"></div>
      <button id="startGuidedBtn">Start Guided Session</button>
    </section>

    <div class="container">
      <!-- Left Column: API Configuration -->
      <div class="left-column">
        <!-- Connection Setup -->
        <section>
          <h2>API Configuration</h2>

          <!-- Connection Settings -->
          <details open>
            <summary>Connection Settings</summary>
            <div>
              <label for="proxyUrl">Proxy WebSocket URL:</label><br />
              <input
                type="text"
                id="proxyUrl"
                placeholder="ws://localhost:8080"
                value="ws://localhost:8080" />
            </div>

            <div>
              <label for="projectId">Project ID:</label><br />
              <input type="text" id="projectId" value="" />
            </div>

            <div>
              <label for="model">Model ID:</label><br />
              <input
                type="text"
                id="model"
                value="gemini-live-2.5-flash-native-audio"
                placeholder="Enter model ID" />
            </div>
          </details>

          <!-- Gemini Behavior Settings -->
          <br />
          <details open>
            <summary>Gemini Behavior</summary>
            <div>
              <label for="systemInstructions">System Instructions:</label><br />
              <textarea id="systemInstructions" rows="3" cols="50">
You are a helpful assistant. Be concise and friendly.</textarea
              >
            </div>

            <div>
              <label for="voiceSelect">Voice:</label><br />
              <select id="voiceSelect">
                <option value="Puck">Puck (Default)</option>
                <option value="Charon">Charon</option>
                <option value="Kore">Kore</option>
                <option value="Fenrir">Fenrir</option>
                <option value="Aoede">Aoede</option>
              </select>
            </div>

            <div>
              <label for="temperature"
                >Temperature: <span id="temperatureValue">1.0</span></label
              ><br />
              <input
                type="range"
                id="temperature"
                min="0.1"
                max="2.0"
                step="0.1"
                value="1.0" />
              <br />
              <small
                >Controls randomness (0.0-2.0]. Higher = more creative/diverse,
                Lower = more predictable/focused</small
              >
            </div>

            <div>
              <input type="checkbox" id="enableProactiveAudio" checked />
              <label for="enableProactiveAudio"
                >Enable proactive audio (Gemini will ignore speech based on
                instructions)</label
              >
            </div>

            <div>
              <input type="checkbox" id="enableGrounding" />
              <label for="enableGrounding"
                >Enable Google grounding (Enabling Google grounding will disable
                custom tools)
              </label>
            </div>

            <div>
              <input type="checkbox" id="enableAffectiveDialog" checked />
              <label for="enableAffectiveDialog"
                >Enable affective dialog (emotion detection and empathetic
                responses)</label
              >
            </div>
          </details>

          <!-- Custom Tools -->
          <br />
          <details>
            <summary>Custom Tools</summary>

            <div>
              <input type="checkbox" id="enableAlertTool" checked />
              <label for="enableAlertTool">Show Alert Box</label>
              <span> (Display browser alerts) </span>
            </div>

            <div>
              <input type="checkbox" id="enableCssStyleTool" checked />
              <label for="enableCssStyleTool">Add CSS Style</label>
              <span> (Inject CSS styles into the page) </span>
            </div>

            <div>
              <input type="checkbox" id="enableDotsTool" checked />
              <label for="enableDotsTool">Dots Tool</label>
              <span> (Lights 1920x1080 dot patterns/animations) </span>
            </div>

            <div>
              <input type="checkbox" id="enableLocateTool" checked />
              <label for="enableLocateTool">Locate Element</label>
              <span> (Precisely find and highlight UI elements on screen) </span>
            </div>
          </details>

          <!-- Transcription Settings -->
          <br />
          <details>
            <summary>Transcription Settings</summary>
            <div>
              <input type="checkbox" id="enableInputTranscription" checked />
              <label for="enableInputTranscription"
                >Enable input transcription (your speech)</label
              >
            </div>

            <div>
              <input type="checkbox" id="enableOutputTranscription" checked />
              <label for="enableOutputTranscription"
                >Enable output transcription (Gemini responses)</label
              >
            </div>
          </details>

          <!-- Activity Detection Settings -->
          <br />
          <details>
            <summary>Activity Detection Settings</summary>
            <div>
              <input type="checkbox" id="disableActivityDetection" />
              <label for="disableActivityDetection"
                >Disable automatic activity detection</label
              >
            </div>

            <div>
              <label for="silenceDuration">Silence duration (ms):</label><br />
              <input
                type="number"
                id="silenceDuration"
                value="500"
                min="500"
                max="10000"
                step="100" />
            </div>

            <div>
              <label for="prefixPadding">Prefix padding (ms):</label><br />
              <input
                type="number"
                id="prefixPadding"
                value="500"
                min="0"
                max="2000"
                step="100" />
            </div>

            <div>
              <label for="endSpeechSensitivity"
                >End of speech sensitivity:</label
              ><br />
              <select id="endSpeechSensitivity">
                <option value="END_SENSITIVITY_UNSPECIFIED" selected>
                  Default
                </option>
                <option value="END_SENSITIVITY_HIGH">
                  High (quicker cutoff)
                </option>
                <option value="END_SENSITIVITY_LOW">Low (longer wait)</option>
              </select>
            </div>

            <div>
              <label for="startSpeechSensitivity"
                >Start of speech sensitivity:</label
              ><br />
              <select id="startSpeechSensitivity">
                <option value="START_SENSITIVITY_UNSPECIFIED" selected>
                  Default
                </option>
                <option value="START_SENSITIVITY_HIGH">
                  High (quicker detection)
                </option>
                <option value="START_SENSITIVITY_LOW">
                  Low (more filtering)
                </option>
              </select>
            </div>

            <div>
              <label for="activityHandling">Activity Handling:</label><br />
              <select id="activityHandling">
                <option value="ACTIVITY_HANDLING_UNSPECIFIED" selected>
                  Default (Interrupts)
                </option>
                <option value="START_OF_ACTIVITY_INTERRUPTS">
                  Interrupt (Barge-in)
                </option>
                <option value="NO_INTERRUPTION">No Interruption</option>
              </select>
            </div>
          </details>

          <br />

          <div>
            <button id="connectBtn">Connect</button>
            <button id="disconnectBtn">Disconnect</button>
          </div>

          <br />

          <div id="connectionStatus">Not connected</div>

          <br />

          <!-- Setup Message JSON Display -->
          <details id="setupJsonSection" style="display: none">
            <summary>
              Setup Message JSON (raw config sent to Gemini API)
            </summary>
            <pre id="setupJsonDisplay"></pre>
          </details>
        </section>
      </div>

      <!-- Right Column: Media and Chat -->
      <div class="right-column">
        <!-- Media Controls -->
        <section>
          <h2>Media Streaming</h2>

          <div class="container">
            <div class="left-column">
              <!-- Device Selectors -->
              <div style="margin-bottom: 10px">
                <div style="margin-bottom: 5px">
                  <label for="micSelect">Microphone:</label><br />
                  <select id="micSelect" style="width: 100%; max-width: 300px">
                    <option value="">Default Microphone</option>
                  </select>
                </div>

                <div style="margin-bottom: 10px">
                  <label for="cameraSelect">Camera:</label><br />
                  <select
                    id="cameraSelect"
                    style="width: 100%; max-width: 300px">
                    <option value="">Default Camera</option>
                  </select>
                </div>
              </div>

              <div>
                <button id="startAudioBtn">Start Audio</button>
                <button id="startVideoBtn">Start Video</button>
                <button id="startScreenBtn">Share Screen</button>
              </div>

              <br />
              <div style="display: grid; gap: 6px; max-width: 420px">
                <label for="proactiveRule">Proactive check rule:</label>
                <textarea
                  id="proactiveRule"
                  rows="3"
                  placeholder="Example: Say hello when you see exactly five fingers."
                  style="width: 100%"></textarea>
                <div style="display: flex; align-items: center; gap: 10px">
                  <button id="toggleProactiveCheckBtn">Start Proactive Check</button>
                  <small>Status: <span id="proactiveCheckStatus">idle</span></small>
                </div>
              </div>

              <br />
              <div>
                <label for="volume">Output volume:</label>
                <input type="range" id="volume" min="0" max="100" value="80" />
                <span id="volumeValue">80%</span>
              </div>
            </div>

            <div class="right-column">
              <video
                id="videoPreview"
                autoplay
                playsinline
                muted
                hidden
                width="400"></video>
            </div>
          </div>
        </section>

        <!-- Chat Interface -->
        <section>
          <h2>Chat</h2>

          <div
            id="chatContainer"
            style="
              border: 1px solid;
              height: 300px;
              overflow-y: auto;
              padding: 10px;
            ">
            <div>Connect to Gemini to start chatting</div>
          </div>
          <br />
          <div>
            <input
              type="text"
              id="chatInput"
              placeholder="Type a message..."
              autocomplete="off" />
            <button id="sendBtn">Send</button>
          </div>
        </section>

        <!-- Debug Info -->
        <section>
          <h2>Debug Info</h2>
          <pre id="debugInfo">Ready to connect...</pre>
        </section>
      </div>
    </div>

    <!-- Load libraries -->
    <script src="geminilive.js"></script>
    <script src="mediaUtils.js"></script>
    <script src="tools.js"></script>
    <script src="script.js"></script>
    <script src="analyze.js"></script>
  </body>
</html>
